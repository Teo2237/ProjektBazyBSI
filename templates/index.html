<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baza Gier</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
            color: #212529;
        }
        /* UJEDNOLICONE STYLE DLA NAGŁÓWKA */
        #page-header {
            background-color: #ffffff;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .site-title a {
            font-size: 1.5em;
            font-weight: 700;
            color: #212529;
            text-decoration: none;
        }
        .header-nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .header-nav a {
            color: #495057;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }
        .header-nav a:hover, .header-nav a.active {
            color: #0d6efd;
        }
        .header-nav .admin-btn {
            background-color: #28a745;
            color: #fff !important;
            padding: 9px 18px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }
        .header-nav .admin-btn:hover {
            background-color: #218838;
        }
        /* Koniec stylów nagłówka */

        main {
            padding: 20px 40px;
        }
        .title-header { text-align: center; margin-bottom: 20px; margin-top: 20px; }
        h1 { color: #4a5568; font-weight: 700; }
        #controls { display: flex; justify-content: center; gap: 20px; margin-bottom: 40px; flex-wrap: wrap; }
        #controls select { padding: 10px 15px; border-radius: 8px; border: 1px solid #ced4da; background-color: #fff; font-family: 'Poppins', sans-serif; font-size: 0.9em; }
        #games-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; max-width: 1400px; margin: 0 auto; }
        
        .game-card {
            border: 1px solid #e2e8f0; border-radius: 16px; overflow: hidden; background-color: #ffffff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex; flex-direction: column; text-decoration: none; color: inherit;
        }
        .game-card:hover { transform: translateY(-8px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); }
        .game-card img { width: 100%; height: 160px; object-fit: cover; }
        .game-card-content { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .game-card-content h3 { margin: 0 0 8px 0; font-size: 1.25em; font-weight: 600; color: #1a202c; }
        .game-card-content p { margin: 0 0 4px 0; font-size: 0.9em; color: #718096; }
        .genre-tags-container { margin-top: auto; padding-top: 15px; display: flex; flex-wrap: wrap; gap: 6px; }
        .genre-tag { background-color: #eef2ff; color: #4338ca; padding: 4px 12px; border-radius: 9999px; font-size: 0.75em; font-weight: 500; }
    /* Style dla stopki */
#page-footer {
    background-color: #343a40;
    color: #adb5bd;
    padding: 40px;
    margin-top: 60px;
    text-align: center;
}
#page-footer .footer-nav {
    margin-bottom: 20px;
}
#page-footer .footer-nav a {
    color: #ced4da;
    text-decoration: none;
    margin: 0 15px;
    transition: color 0.2s;
}
#page-footer .footer-nav a:hover {
    color: #fff;
}
#page-footer .copyright {
    font-size: 0.9em;
}
    </style>
</head>
<body>

    <header id="page-header">
        <div class="site-title">
            <a href="/">GameBase</a>
        </div>
        <nav class="header-nav">
            <a href="/" class="active">Katalog</a>
            <a href="/about">O nas</a>
            <a href="/contact">Kontakt</a>
            <a href="/faq">FAQ</a>
            <a href="/admin" class="admin-btn">Panel Admina</a>
        </nav>
    </header>

    <main>
        <div class="title-header">
            <h1>Katalog Gier</h1>
            <div id="controls">
                <select id="genre-filter"><option value="">Filtruj po gatunku...</option></select>
                <select id="sort-control">
                    <option value="">Sortuj domyślnie</option>
                    <option value="title">Tytuł (A-Z)</option>
                    <option value="-title">Tytuł (Z-A)</option>
                    <option value="-release_date">Data (od najnowszych)</option>
                    <option value="release_date">Data (od najstarszych)</option>
                </select>
            </div>
        </div>
        <div id="games-container"><p>Ładowanie gier...</p></div>
    </main>

    <script>
        // Cały kod JavaScript pozostaje bez zmian
        document.addEventListener('DOMContentLoaded', () => {
            const gamesContainer = document.getElementById('games-container');
            const genreFilter = document.getElementById('genre-filter');
            const sortControl = document.getElementById('sort-control');
            const renderGames = (games) => {
                gamesContainer.innerHTML = '';
                if (games.length === 0) {
                    gamesContainer.innerHTML = '<p>Nie znaleziono gier spełniających wybrane kryteria.</p>';
                    return;
                }
                games.forEach(game => {
                    const cardLink = document.createElement('a');
                    cardLink.className = 'game-card';
                    cardLink.href = `/games/${game._id}`;
                    const genresHTML = game.genres.map(genre => `<span class="genre-tag">${genre}</span>`).join('');
                    cardLink.innerHTML = `
                        <img src="${game.cover_image}" alt="Okładka gry ${game.title}">
                        <div class="game-card-content">
                            <div>
                                <h3>${game.title}</h3>
                                <p>Data wydania: ${game.release_date}</p>
                                <p>Deweloper: ${game.developer || 'Brak danych'}</p>
                            </div>
                            <div class="genre-tags-container">
                                ${genresHTML}
                            </div>
                        </div>
                    `;
                    gamesContainer.appendChild(cardLink);
                });
            };
            const fetchFilteredGames = async () => {
                const genre = genreFilter.value;
                const sort = sortControl.value;
                const params = new URLSearchParams();
                if (genre) params.append('genre', genre);
                if (sort) params.append('sort', sort);
                const queryString = params.toString();
                const url = `/api/games${queryString ? '?' + queryString : ''}`;
                try {
                    gamesContainer.innerHTML = '<p>Ładowanie gier...</p>';
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`Błąd HTTP! Status: ${response.status}`);
                    const games = await response.json();
                    renderGames(games);
                } catch (error) {
                    gamesContainer.innerHTML = `<p style="color: red;">Wystąpił błąd: ${error.message}</p>`;
                    console.error('Błąd podczas pobierania filtrowanych gier:', error);
                }
            };
            const setupGenreFilter = async () => {
                try {
                    const response = await fetch('/api/games');
                    if (!response.ok) throw new Error('Nie można pobrać gatunków.');
                    const games = await response.json();
                    const allGenres = new Set();
                    games.forEach(game => game.genres.forEach(genre => allGenres.add(genre)));
                    const sortedGenres = [...allGenres].sort();
                    sortedGenres.forEach(genre => {
                        const option = document.createElement('option');
                        option.value = genre;
                        option.textContent = genre;
                        genreFilter.appendChild(option);
                    });
                } catch (error) {
                    console.error('Błąd podczas ustawiania filtrów gatunków:', error);
                }
            };
            genreFilter.addEventListener('change', fetchFilteredGames);
            sortControl.addEventListener('change', fetchFilteredGames);
            const init = async () => {
                await setupGenreFilter();
                await fetchFilteredGames();
            };
            init();
        });
    </script>
    <footer id="page-footer">
    <div class="footer-nav">
        <a href="/">Katalog</a>
        <a href="/about">O nas</a>
        <a href="/contact">Kontakt</a>
        <a href="/faq">FAQ</a>
    </div>
    <p class="copyright">
        &copy; <span id="current-year"></span> GameBase. Wszelkie prawa zastrzeżone.
    </p>
</footer>

<script>
    // Skrypt do dynamicznego wstawiania bieżącego roku w stopce
    // Umieszczony tutaj, aby był niezależny od innych skryptów na stronie
    if (document.getElementById('current-year')) {
        document.getElementById('current-year').textContent = new Date().getFullYear();
    }
</script>
</body>
</html>